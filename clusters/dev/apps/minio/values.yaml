minio:
  fullnameOverride: minio

  global:
    imagePullSecrets:
      - docker-registry-secret

  image:
    repository: hdc-services-external/bitnami/minio
    # tag from versions.yaml (2022.12.12-debian-11-r9)

  mode: standalone

  auth:
    existingSecret: minio-credentials
    # Chart expects keys: root-user, root-password

  persistence:
    enabled: true
    storageClass: "csi-cinder-high-speed"
    accessMode: ReadWriteOnce
    size: 5Gi

  resources:
    requests:
      memory: 256Mi
      cpu: 100m
    limits:
      memory: 512Mi
      cpu: 500m

  # Console ingress - not needed, internal access only
  ingress:
    enabled: false

  # S3 API ingress - public endpoint for S3_PUBLIC access
  apiIngress:
    enabled: true
    ingressClassName: nginx
    hostname: object.dev.hdc.ebrains.eu
    path: /
    pathType: Prefix
    servicePort: minio-api
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-prod
      nginx.ingress.kubernetes.io/proxy-body-size: 20m
      nginx.ingress.kubernetes.io/proxy-buffer-size: 512k
      nginx.ingress.kubernetes.io/proxy-buffering: "on"
      nginx.ingress.kubernetes.io/proxy-buffers-number: "8"
      nginx.ingress.kubernetes.io/proxy-connect-timeout: 180s
      nginx.ingress.kubernetes.io/proxy-max-temp-file-size: "0"
      nginx.ingress.kubernetes.io/proxy-read-timeout: 180s
      nginx.ingress.kubernetes.io/proxy-send-timeout: 180s
    tls: true

  service:
    type: ClusterIP

  # Encryption via built-in master key (no KES needed)
  extraEnvVars:
    - name: MINIO_KMS_SECRET_KEY
      valueFrom:
        secretKeyRef:
          name: minio-credentials
          key: kms-secret-key
